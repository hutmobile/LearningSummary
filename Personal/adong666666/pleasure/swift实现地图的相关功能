swift å®šä½ æ ¹æ®å®šä½åˆ°çš„ç»çº¬åº¦è½¬æ¢åŸå¸‚å

ï¼ˆ1ï¼‰å¯¼å…¥åœ°å›¾åº“ ï¼šMapKit.framework  å°±æ˜¯è¿™ä¸ª

ï¼ˆ2ï¼‰åœ¨ä½ éœ€è¦ç”¨åˆ°çš„åœ°æ–¹ import  CoreLocation 

ï¼ˆ3ï¼‰ç”³è¯·ä¸¤ä¸ªå˜é‡ è®°å¾—éµå®ˆ CLLocationManagerDelegate åè®®ğŸ˜

    var currLocation : CLLocation! //è¿™ä¸ªæ˜¯ä¿å­˜å®šä½ä¿¡æ¯çš„  åˆ«ä¹±æƒ³å“ˆ

    let locationManager : CLLocationManager = CLLocationManager()//è¿™ä¸ªä¹Ÿç®—æ˜¯çŒªè„š

ï¼ˆ4ï¼‰è®¾ç½®ä¸€äº›å¿…è¦çš„å±æ€§  å®ç°ä»£ç†  å¼€å§‹å®šä½  

        locationManager.requestAlwaysAuthorization()

        locationManager.desiredAccuracy = kCLLocationAccuracyBest 

        locationManager.distanceFilter = kCLLocationAccuracyKilometer

        locationManager.delegate = self

        locationManager.startUpdatingLocation()//å¼€å§‹å®šä½  åœ¨å®šä½å®Œæˆå ä¼šè°ƒç”¨åè®®æ–¹æ³•  è¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº† 

ï¼ˆ5ï¼‰æ¥ä¸‹æ¥å°±æ˜¯å®šä½çš„åè®®æ–¹æ³•äº† 

   //MARK:CLLocationManagerDelegate

    func locationManager(manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {//å®šä½æˆåŠŸ

        

        currLocation = locations.last //å–å‡ºç»çº¬åº¦

        print(currLocation.coordinate.longitude)

        print(currLocation.coordinate.latitude)

        LonLatToCity()//å»è°ƒç”¨è½¬æ¢

    }

    func locationManager(manager: CLLocationManager, didFailWithError error: NSError) {//å®šä½å¤±è´¥

        print(error)

        self.noticeOnlyText("å“‡é ï¼ï¼å®šä½æ€ä¹ˆå¤±è´¥äº†å‘¢")

        

    }

ï¼ˆ6ï¼‰//è¿™ä¸ªå°±æ˜¯è¦è½¬æ¢çš„æ–¹æ³•äº† ğŸ˜

ã€€ã€€func LonLatToCity() {

        let geocoder: CLGeocoder = CLGeocoder()

        geocoder.reverseGeocodeLocation(currLocation) { (placemark, error) -> Void in

            

            if(error == nil)//æˆåŠŸ

            {

                let array = placemark! as NSArray

                let mark = array.firstObject as! CLPlacemark

                //è¿™ä¸ªæ˜¯åŸå¸‚

                let city: String = (mark.addressDictionary! as NSDictionary).valueForKey("City") as! String

                //è¿™ä¸ªæ˜¯å›½å®¶

                let country: NSString = (mark.addressDictionary! as NSDictionary).valueForKey("Country") as! NSString

                //è¿™ä¸ªæ˜¯å›½å®¶çš„ç¼–ç 

                let CountryCode: NSString = (mark.addressDictionary! as NSDictionary).valueForKey("CountryCode") as! NSString

                //è¿™æ˜¯è¡—é“ä½ç½®

                let FormattedAddressLines: NSString = (mark.addressDictionary! as NSDictionary).valueForKey("FormattedAddressLines")?.firstObject as! NSString

                //è¿™æ˜¯å…·ä½“ä½ç½®

                let Name: NSString = (mark.addressDictionary! as NSDictionary).valueForKey("Name") as! NSString

                //è¿™æ˜¯çœ

                var State: String = (mark.addressDictionary! as NSDictionary).valueForKey("State") as! String

                //è¿™æ˜¯åŒº

                let SubLocality: NSString = (mark.addressDictionary! as NSDictionary).valueForKey("SubLocality") as! NSString

                //æˆ‘åœ¨è¿™é‡Œå»æ‰äº†â€œçœâ€å’Œâ€œå¸‚â€ é¡¹ç›®éœ€æ±‚ å¯ä»¥å¿½ç•¥

                State = State.stringByReplacingOccurrencesOfString("çœ", withString: "")

                let citynameStr = city.stringByReplacingOccurrencesOfString("å¸‚", withString: "")

ã€€ã€€ã€€ã€€ã€€ã€€//åœ¨è¿™é‡Œç›´æ¥èµ‹å€¼ç»™äº†ä¹‹å‰å®šä¹‰çš„å˜é‡

                self.provinces  = State

                self.city = citynameStr

                print( State)

                print( citynameStr)

ã€€ã€€ã€€ã€€ã€€ã€€//ä¸‹é¢çš„è¿™ä¸ªæ–¹æ³•åªæœ‰æˆ‘å’Œä¸Šå¸çŸ¥é“å®ƒæ˜¯å¹²å˜›ç”¨çš„  ğŸ˜€  

                self.saveLocationSearch([State,citynameStr])

            }

            else

            {

                print(error)

                self.noticeOnlyText("å®šä½å¥½åƒå¤±è´¥äº†å“¦")

            }

        }

    }

ï¼ˆ7ï¼‰å®Œæ´» ğŸ˜

![image](https://github.com/HutMobileDevelopmentGroup/LearningSummary/Personal/adong666666/pleasure/ç”¨swiftå®ç°åœ°å›¾çš„ç›¸å…³åŠŸèƒ½.jpg)



